## solution: dns

1. What's the IP address for the DNS server for this system? How did you find it? This may differ depending on your Linux distribution.

    > You can usually start with looking for a line with `nameserver` in `/etc/resolv.conf`. If it is not there, there's probably a problem with the IP configuration. If it has an IP address *other than 127.0.0.53, that's the DNS server for the system.
    >
    > For example, on Enterprise Linux:

    ```console
    [student@el ~]$ cat /etc/resolv.conf 
    # Generated by NetworkManager
    nameserver 10.0.2.3
    ```

    > The following example is from Fedora. We use `grep` to only show lines that start with `nameserver`:

    ```console
    [student@fedora ~]$ grep '^nameserver' /etc/resolv.conf 
    nameserver 127.0.0.53
    ```

    > In this case, we see 127.0.0.53 as the DNS server, which indicates that the system is using `systemd-resolved` for DNS resolution. The DNS server can then be found by issuing the command:

    ```console
    [student@fedora ~]$ resolvectl dns
    Global:
    Link 2 (eth0): 10.0.2.3
    Link 3 (eth1):
    ```

    > Remark that in both cases, the IP address 10.0.2.3 is the DNS server provided by a VirtualBox NAT network. If you are working on a VM with a NAT interface, you should see the same IP. If your network configuration is different, the DNS will also be different.
    >
    > Debian will usually *not* use `systemd-resolved`, so the DNS server will be in `/etc/resolv.conf`. Default installations of Ubuntu and Mint *do* use `systemd-resolved`, so you will need to use the `resolvectl` command.

2. Try some DNS queries using `getent`, `host`, `nslookup` and `dig`. See how the output differs.

    - Try to resolve the IP address for `www.linux-training.be` or some well known websites.

        > The following example shows the output of the four commands for the domain `www.linux-training.be`. The IP addresses are the same, but the output format differs. These commands should be available on most Linux distributions, and produce the same or similar output.
        >
        > Remark that in these examples, we use the `!$` syntax to refer to the last argument of the previous command. This is a bash feature that can save you some typing.

        ```console
        student@linux:~$ getent ahosts www.linux-training.be
        188.40.26.208   STREAM www.linux-training.be
        188.40.26.208   DGRAM  
        188.40.26.208   RAW    
        2a01:4f8:d0a:1044::2 STREAM 
        2a01:4f8:d0a:1044::2 DGRAM  
        2a01:4f8:d0a:1044::2 RAW  
        student@linux:~$ host !$
        host www.linux-training.be
        www.linux-training.be has address 188.40.26.208
        www.linux-training.be has IPv6 address 2a01:4f8:d0a:1044::2
        student@debilinuxan:~$ nslookup !$
        nslookup www.linux-training.be
        Server:         10.0.2.3
        Address:        10.0.2.3#53

        Non-authoritative answer:
        Name:   www.linux-training.be
        Address: 188.40.26.208
        Name:   www.linux-training.be
        Address: 2a01:4f8:d0a:1044::2

        student@linux:~$ dig +short !$
        dig +short www.linux-training.be
        188.40.26.208
        ```

    - Try reverse DNS lookups (PTR) and other types of queries (AAAA, MX, SOA, etc.).

        ```console
        student@linux:~$ dig -x 188.40.26.208 +short
        www115.your-server.de.
        student@linux:~$ dig AAAA www.linux-training.be +short
        2a01:4f8:d0a:1044::2
        student@linux:~$ dig MX linux-training.be +short
        10 www115.your-server.de.
        student@linux:~$ dig SOA linux-training.be +short
        ns1.your-server.de. postmaster.your-server.de. 2021083002 86400 10800 3600000 3600
        student@linux:~$ dig AXFR linux-training.be +short
        ```

3. Try to determine the authoritative DNS server for your Internet Service Provider, or for the DNS server of the organization you are affiliated with.

    > We'll use the *hogent.be* domain (HOGENT or Ghent University of Applied Sciences) as an example.

   - Try some forward (IPv4 and IPv6) and reverse DNS queries.

        ```console
        student@linux:~$ dig NS hogent.be +short
        ns2.hogent.be.
        ns1.hogent.be.
        student@linux:~$ dig @ns1.hogent.be www.hogent.be +short
        hogent.be.
        193.190.173.135
        student@linux:~$ dig @ns1.hogent.be AAAA www.hogent.be +short
        hogent.be.
        student@linux:~$ dig @ns1.hogent.be AAAA ns1.hogent.be +short
        2001:6a8:1c60:ab00::1
        student@linux:~$ dig @ns1.hogent.be -x 193.190.173.135 +short
        drit-web-www.hogent.be.
        ```

   - Try to find the mail server for this domain

        ```console
        student@linux:~$ dig @ns1.hogent.be MX hogent.be +short
        0 hogent-be.mail.protection.outlook.com.
        ```

   - The following exercise may yield different results depending whether you're inside the organization's network or not. Can you request a zone transfer? What happens? If you do get a zone transfer, what information do you get?

        ```console
        student@debian:~$ dig @ns1.hogent.be AXFR hogent.be
        ; <<>> DiG 9.18.19-1~deb12u1-Debian <<>> @ns2.hogent.be AXFR hogent.be
        ; (2 servers found)
        ;; global options: +cmd
        ; Transfer failed.
        ```

        > The zone transfer failed. Zone transfers are usually restricted to a list of authorized servers. If you are not on that list, you will not be able to request a zone transfer. Outside of the organization's network, you should never be able to request a zone transfer of any domain. In this example, we executed the request inside the campus network, but the zone transfer was still denied.

4. Go to <https://www.dns.toys> and try some of the tools there.

    ```console
    student@debian:~$ dig brussels.time @dns.toys +short
    "Brussels (Europe/Brussels, BE)" "Mon, 30 Sep 2024 10:00:31 +0200"
    student@debian:~$ dig brussels.weather @dns.toys +short
    "Brussels (BE)" "8.10C (46.58F)" "80.90% hu." "cloudy" "19:00, Tue"
    "Brussels (BE)" "7.60C (45.68F)" "82.00% hu." "cloudy" "21:00, Tue"
    "Brussels (BE)" "7.30C (45.14F)" "84.30% hu." "cloudy" "23:00, Tue"
    "Brussels (BE)" "6.80C (44.24F)" "91.40% hu." "cloudy" "01:00, Wed"
    "Brussels (BE)" "6.30C (43.34F)" "93.40% hu." "cloudy" "03:00, Wed"
    student@debian:~$ dig 42mi-km.unit @dns.toys +short
    "42.00 Mile (mi) = 67.59 Kilometer (km)"
    student@debian:~$ dig 1000USD-EUR.fx @dns.toys +short
    "1000.00 USD = 895.52 EUR" "Mon, 30 Sep 2024 00:02:31 +0000"
    student@debian:~$ dig -4 ip @dns.toys +short
    "193.190.172.131"
    student@debian:~$ dig -6 ip @dns.toys +short
    ;; UDP setup with 2604:a880:400:d0::1352:6001#53(2604:a880:400:d0::1352:6001) for ip failed: network unreachable.
    ;; UDP setup with 2604:a880:400:d0::1352:6001#53(2604:a880:400:d0::1352:6001) for ip failed: network unreachable.
    ;; UDP setup with 2604:a880:400:d0::1352:6001#53(2604:a880:400:d0::1352:6001) for ip failed: network unreachable.
    student@debian:~$ dig 2d20.dice @dns.toys +short
    "rolled = [3, 4]"
    "total = 7"
    ```

1. Go to <https://digi.ninja/projects/zonetransferme.php> and try the suggested exercises there.

    > Transcript of the exercises can be found on the linked page itself.

